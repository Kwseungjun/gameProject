#include "map.h"
#include "game.h"
#include "attack.h"
#include "displayControl.h"
#include "monster.h"

//┌─┐│└┘

void border() {
	gotoxy(0, 0);
	printscr("        ┌───────────────────────────────────────────────────┐\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        │                                                                                                      │\n");
	printscr("        └───────────────────────────────────────────────────┘");

}


char tempMap[MAPYMAX+1][MAPXMAX+1];

char map1[MAPYMAX + 1][MAPXMAX + 1] = {
		{"111111111111111111111111111111111111111111111111ooooooooo1111111111111111111111111111111111111111111"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"10000000000000000000000000000000000000000000000000P0000000000000000000000000000000000000000000000001"},
		{"10000000000000000000000000000000000000000000000000p0000000000000000000000000000000000000000000000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"100110000000000000000000001100000000000!00000000001100000000000!000000000110000000000000001100000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"100110000000000000000000001100000000000!00000000001100000000000!000000000110000000000000001100000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"111111111111111111111111111111111111111111111111ooooooooo1111111111111111111111111111111111111111111"}
};

char map2[MAPYMAX + 1][MAPXMAX + 1] = {
		{"111111111111111111111111111111111111111111111111ooooooooo1111111111111111111111111111111111111111111"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"10011100000000!00000000000111000000000!0000000000011100000000000!000000001110000000!0000001110000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"10011100000000!00000000000111000000000!0000000000011100000000000!000000001110000000!0000001110000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"10011100000000!00000000000111000000000!0000000000011100000000000!000000001110000000!0000001110000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"10011100000000!00000000000111000000000!0000000000011100000000000!000000001110000000!0000001110000001"},
		{"10000000000000000000000000000000000000000000000000P0000000000000000000000000000000000000000000000001"},
		{"10000000000000000000000000000000000000000000000000p0000000000000000000000000000000000000000000000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"10011100000000!00000000000111000000000!0000000000011100000000000!000000001110000000!0000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"10011100000000!00000000000111000000000!000000000001110000000000!0000000001110000000!0000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"10011100000000!00000000000111000000000!000000000001110000000000!0000000001110000000!0000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"10011100000000!00000000000111000000000!000000000001110000000000!0000000001110000000!0000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"111111111111111111111111111111111111111111111111ooooooooo1111111111111111111111111111111111111111111"}
};

char map3[MAPYMAX + 1][MAPXMAX + 1] = {
		{"111111111111111111111111111111111111111111111111ooooooooo1111111111111111111111111111111111111111111"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"10000000000000000000000000000000000000000000000000P0000000000000000000000000000000000000000000000001"},
		{"10000000000000000000000000000000000000000000000000p0000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"111111111111111111111111111111111111111111111111ooooooooo1111111111111111111111111111111111111111111"}
};

//전체 맵 그리기
void drawMap(int* x, int* y)
{
	//뒷장 페이지 초기화
	scr_clear();
	//테두리 그리기
	border();
	drawInfo();
	gotoxy(MAPXSTART, 1);
	//플레이어 기준 x값 최소, 최대 | y값 최소 최대 결정
	int hLow, hHigh, wLow, wHigh;

	//위, 아래, 왼쪽, 오른쪽 끝으로 갔을때 작아진 부분만큼 반대쪽 맵 크기 늘리기
	int hUpDif = 0, hDownDif = 0, wLeftDif = 0, wRightDif = 0;
	int i = 1;

	//맵의 최소, 최대값 설정
	if (*y - MAPYHALF < 0) {
		hLow = 0;
		hUpDif = 0 - (*y - MAPYHALF);
	}
	else
		hLow = *y - MAPYHALF;

	if (*y + MAPYHALF > MAPYMAX) {
		hHigh = MAPYMAX;
		hDownDif = (*y + MAPYHALF) - MAPYMAX;
		hLow = hLow - hDownDif;
	}
	else
		hHigh = *y + MAPYHALF + hUpDif;

	if (*x - MAPXHALF < 0) {
		wLow = 0;
		wLeftDif = 0 - (*x - MAPXHALF);
	}
	else
		wLow = *x - MAPXHALF;

	if (*x + MAPXHALF > MAPXMAX) {
		wHigh = MAPXMAX;
		wRightDif = (*x + MAPXHALF) - MAPXMAX;
		wLow = wLow - wRightDif;
	}
	else
		wHigh = *x + MAPXHALF + wLeftDif;

	//맵 그리기
	for (int h = hLow; h <= hHigh; h++) {
		for (int w = wLow; w <= wHigh; w++) {
			char temp = tempMap[h][w];
			//빈곳
			if (temp == '0') {
				printscr("  ");
			}
			//몬스터 스폰지역
			else if (temp == 'o') {
				printscr("  ");
			}
			//벽1
			else if (temp == '1') {
				printscr("■");
			}
			//플레이어 머리
			else if (temp == 'P') {
				*x = w;
				*y = h;
				printscr("○");
			}
			//플레이어 몸통
			else if (temp == 'p') {
				*x = w;
				*y = h;
				printscr("☆");
			}
			//가로총알
			else if (temp == 'w') {
				printscr("─");
			}
			//세로총알
			else if (temp == 'h') {
				printscr("│");
			}
			//샷건총알
			else if (temp == 's') {
				printscr("⊙");
			}
			//몬스터
			else if (temp == 'q') {
				printscr("◆");
			}
			else if (temp == 't') {
				printscr("◇");
			}
			else if (temp == 'e') {
				printscr("▲");
			}
			else if (temp == 'r') {
				printscr("△");
			}
			//배럴 아이템
			else if (temp == 'z') {
				printscr("BR");
			}
			//AR 탄창
			else if (temp == 'x') {
				printscr("AR");
			}
			//SG 탄창
			else if (temp == 'c') {
				printscr("SG");
			}
			//SR 탄창
			else if (temp == 'v') {
				printscr("SR");
			}
			//체력 회복 아이템
			else if (temp == 'n') {
				printscr("♥");
			}
			//부서지는 벽
			else if (temp == '!') {
				printscr("▩");
			}
			//배럴
			else if (temp == 'k') {
				printscr("▦");
			}
			//배럴 폭발 모션
			else if (temp == 'K') {
				printscr("▣");
			}
		}
		i++;
		gotoxy(MAPXSTART, i);
	}

	//뒷장, 앞장 전환
	scr_switch();
}

void drawInfo() {
	//체력 출력
	gotoxy(10, 28);
	printscr("체력 : ");
	for (int i = 0; i < maxHP; i++) {
		if (i < userHP)
			printscr("♥");
		else
			printscr("♡");
	}

	//남은 몬스터
	gotoxy(10, 30);
	printscr("남은 적 : ");
	int remainMonster = remainMonsterCount;
	char* remainMonster_char = (char*)malloc(sizeof(char) * 4);
	_itoa(remainMonster, remainMonster_char, 10);
	printscr(remainMonster_char);

	//현재 무기출력
	gotoxy(10, 32);
	printscr("현재무기: ");
	switch (selectWeapon) {
	case HG:
		printscr("권총");
		break;
	case AR:
		printscr("돌격소총");
		break;
	case SG:
		printscr("샷건");
		break;
	case SR:
		printscr("스나이퍼");
		break;
	case BR:
		printscr("배럴");
		break;
	}
	//남은총알, 탄창 출력
	gotoxy(10, 34);
	printscr("남은 총알 : ");
	int weaponBullet = weapon[selectWeapon].bullet;

	char* weaponBullet_char = (char*)malloc(sizeof(char) * 4);
	_itoa(weaponBullet, weaponBullet_char, 10);
	printscr(weaponBullet_char);
	printscr(" / 탄창 : ");

	int weaponMagazine = weapon[selectWeapon].magazine;
	char* weaponMagazine_char = (char*)malloc(sizeof(char) * 4);
	_itoa(weaponMagazine, weaponMagazine_char, 10);
	printscr(weaponMagazine_char);

	//재장전 출력
	gotoxy(10, 36);
	if (isReload == TRUE)
		printscr("재장전중...");

}