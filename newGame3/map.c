#include "map.h"
#include "game.h"
#include "attack.h"
#include "displayControl.h"

//┌─┐│└┘

void border() {
	gotoxy(0, 0);
	printscr("        ┌─────────────────────────────────────────────────────────────┐\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        │                                                                                                                          │\n");
	printscr("        └─────────────────────────────────────────────────────────────┘");

}


char tempMap[MAPYMAX+1][MAPXMAX+1];

char map1[MAPYMAX + 1][MAPXMAX + 1] = {
		{"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"10000000000000000000000000000000000000000000000000P0000000000000000000000000000000000000000000000001"},
		{"10000000000000000000000000000000000000000000000000p0000000000000000000000000000000000000000000000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1001100000000000000000000011000000000000000000000011000000000000000000000110000000000000001100000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"}
};

char map2[MAPYMAX + 1][MAPXMAX + 1] = {
		{"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"10000000000000000000000000000000000000000000000000P0000000000000000000000000000000000000000000000001"},
		{"10000000000000000000000000000000000000000000000000p0000000000000000000000000000000000000000000000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1001110000000000000000000011100000000000000000000011100000000000000000000111000000000000001110000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"}
};

char map3[MAPYMAX + 1][MAPXMAX + 1] = {
		{"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"10000000000000000000000000000000000000000000000000P0000000000000000000000000000000000000000000000001"},
		{"10000000000000000000000000000000000000000000000000p0000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1001111000000000000000000011110000000000000000000011110000000000000000000111100000000000001111000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"},
		{"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"}
};

//전체 맵 그리기
void drawMap(int* x, int* y)
{
	//뒷장 페이지 초기화
	scr_clear();
	//테두리 그리기
	border();
	drawInfo();
	gotoxy(MAPXSTART, 1);
	//플레이어 기준 x값 최소, 최대 | y값 최소 최대 결정
	int hLow, hHigh, wLow, wHigh;

	//위, 아래, 왼쪽, 오른쪽 끝으로 갔을때 작아진 부분만큼 반대쪽 맵 크기 늘리기
	int hUpDif = 0, hDownDif = 0, wLeftDif = 0, wRightDif = 0;
	int i = 1;

	//맵의 최소, 최대값 설정
	if (*y - MAPYHALF < 0) {
		hLow = 0;
		hUpDif = 0 - (*y - MAPYHALF);
	}
	else
		hLow = *y - MAPYHALF;

	if (*y + MAPYHALF > MAPYMAX) {
		hHigh = MAPYMAX;
		hDownDif = (*y + MAPYHALF) - MAPYMAX;
		hLow = hLow - hDownDif;
	}
	else
		hHigh = *y + MAPYHALF + hUpDif;

	if (*x - MAPXHALF < 0) {
		wLow = 0;
		wLeftDif = 0 - (*x - MAPXHALF);
	}
	else
		wLow = *x - MAPXHALF;

	if (*x + MAPXHALF > MAPXMAX) {
		wHigh = MAPXMAX;
		wRightDif = (*x + MAPXHALF) - MAPXMAX;
		wLow = wLow - wRightDif;
	}
	else
		wHigh = *x + MAPXHALF + wLeftDif;

	//맵 그리기
	for (int h = hLow; h <= hHigh; h++) {
		for (int w = wLow; w <= wHigh; w++) {
			char temp = tempMap[h][w];
			if (temp == '0') {
				printscr("  ");
			}
			else if (temp == '1') {
				printscr("■");
			}
			else if (temp == 'P') {
				*x = w;
				*y = h;
				printscr("○");
			}
			else if (temp == 'p') {
				*x = w;
				*y = h;
				printscr("☆");
			}
			//가로총알
			else if (temp == 'w') {
				printscr("─");
			}
			//세로총알
			else if (temp == 'h') {
				printscr("│");
			}
			//샷건
			else if (temp == 's') {
				printscr("⊙");
			}
			//몬스터
			else if (temp == 'q') {
				printscr("◆");
			}
			else if (temp == 't') {
				printscr("◇");
			}
			else if (temp == 'e') {
				printscr("▲");
			}
			else if (temp == 'r') {
				printscr("△");
			}
			else if (temp == 'z') {
				printscr("HG");
			}
			else if (temp == 'x') {
				printscr("AR");
			}
			else if (temp == 'c') {
				printscr("SG");
			}
			else if (temp == 'v') {
				printscr("SR");
			}
			else if (temp == 'n') {
				printscr("♥");
			}
		}
		i++;
		gotoxy(MAPXSTART, i);
	}

	//뒷장, 앞장 전환
	scr_switch();
}

void drawInfo() {
	gotoxy(10, 33);
	printscr("현재무기: ");
	switch (selectWeapon) {
	case HG:
		printscr("HG");
		break;
	case AR:
		printscr("AR");
		break;
	case SG:
		printscr("SG");
		break;
	case SR:
		printscr("SR");
		break;
	}

	gotoxy(10, 34);
	printscr("남은 총알 : ");
	int weaponBullet = weapon[selectWeapon].bullet;

	char* weaponBullet_char = (char*)malloc(sizeof(char) * 4);
	_itoa(weaponBullet, weaponBullet_char, 10);
	printscr(weaponBullet_char);
	printscr(" / 탄창 : ");

	int weaponMagazine = weapon[selectWeapon].resetMagazine;
	char* weaponMagazine_char = (char*)malloc(sizeof(char) * 4);
	_itoa(weaponMagazine, weaponMagazine_char, 10);
	printscr(weaponMagazine_char);

	gotoxy(10, 35);
	printscr("남은체력 : ");
	for (int i = 0; i < maxHP; i++) {
		if (i < userHP)
			printscr("♥");
		else
			printscr("♡");
	}
}